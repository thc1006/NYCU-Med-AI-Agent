{"ast":null,"code":"var _s = $RefreshSig$();\n/**\n * 地理位置 Hook\n */\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { locationApi } from '../services/api';\nimport { useLocation } from '../stores/useAppStore';\nimport toast from 'react-hot-toast';\nexport const useGeolocation = (options = {}) => {\n  _s();\n  const {\n    userLocation,\n    locationPermission,\n    setUserLocation,\n    setLocationPermission\n  } = useLocation();\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  // 檢查瀏覽器是否支援地理定位\n  const isSupported = 'geolocation' in navigator;\n\n  /**\n   * 取得目前位置\n   */\n  const getCurrentLocation = useCallback(async () => {\n    if (!isSupported) {\n      var _options$onError;\n      const errorMsg = '此瀏覽器不支援地理定位功能';\n      setError(errorMsg);\n      (_options$onError = options.onError) === null || _options$onError === void 0 ? void 0 : _options$onError.call(options, errorMsg);\n      toast.error(errorMsg);\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      var _options$onSuccess;\n      const position = await locationApi.getCurrentLocation();\n      setUserLocation(position);\n      setLocationPermission(true);\n      setError(null);\n      (_options$onSuccess = options.onSuccess) === null || _options$onSuccess === void 0 ? void 0 : _options$onSuccess.call(options, position);\n      toast.success('已取得您的位置');\n    } catch (err) {\n      var _options$onError2;\n      const errorMsg = err instanceof Error ? err.message : '無法取得位置資訊';\n      setError(errorMsg);\n      setLocationPermission(false);\n      (_options$onError2 = options.onError) === null || _options$onError2 === void 0 ? void 0 : _options$onError2.call(options, errorMsg);\n\n      // 針對不同錯誤類型顯示不同訊息\n      if (errorMsg.includes('拒絕')) {\n        toast.error('請允許位置存取以搜尋附近醫院', {\n          duration: 5000\n        });\n      } else if (errorMsg.includes('超時')) {\n        toast.error('定位超時，請檢查GPS設定');\n      } else {\n        toast.error(errorMsg);\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [isSupported, options, setUserLocation, setLocationPermission]);\n\n  /**\n   * 清除位置資訊\n   */\n  const clearLocation = useCallback(() => {\n    setUserLocation(null);\n    setError(null);\n    setLocationPermission(false);\n  }, [setUserLocation, setLocationPermission]);\n\n  /**\n   * 監聽位置權限變化\n   */\n  useEffect(() => {\n    if (!isSupported) return;\n\n    // 檢查位置權限狀態\n    if ('permissions' in navigator) {\n      navigator.permissions.query({\n        name: 'geolocation'\n      }).then(result => {\n        setLocationPermission(result.state === 'granted');\n\n        // 監聽權限變化\n        result.addEventListener('change', () => {\n          const hasPermission = result.state === 'granted';\n          setLocationPermission(hasPermission);\n          if (result.state === 'denied') {\n            setUserLocation(null);\n            setError('位置存取被拒絕');\n          }\n        });\n      }).catch(() => {\n        // 某些瀏覽器不支援 permissions API\n        console.warn('Cannot check geolocation permission');\n      });\n    }\n  }, [isSupported, setLocationPermission, setUserLocation]);\n  return {\n    location: userLocation,\n    error,\n    loading,\n    getCurrentLocation,\n    clearLocation,\n    isSupported\n  };\n};\n_s(useGeolocation, \"TZ5aiQz6nxQFryB5AHhnDRccUZI=\", false, function () {\n  return [useLocation];\n});","map":{"version":3,"names":["useState","useEffect","useCallback","locationApi","useLocation","toast","useGeolocation","options","_s","userLocation","locationPermission","setUserLocation","setLocationPermission","error","setError","loading","setLoading","isSupported","navigator","getCurrentLocation","_options$onError","errorMsg","onError","call","_options$onSuccess","position","onSuccess","success","err","_options$onError2","Error","message","includes","duration","clearLocation","permissions","query","name","then","result","state","addEventListener","hasPermission","catch","console","warn","location"],"sources":["C:/Users/thc1006/Desktop/dev/NYCU-Med-AI-Agent/frontend/src/hooks/useGeolocation.ts"],"sourcesContent":["/**\n * 地理位置 Hook\n */\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { locationApi } from '../services/api';\nimport { useLocation } from '../stores/useAppStore';\nimport toast from 'react-hot-toast';\n\ninterface UseGeolocationOptions {\n  enableHighAccuracy?: boolean;\n  timeout?: number;\n  maximumAge?: number;\n  onSuccess?: (position: { latitude: number; longitude: number }) => void;\n  onError?: (error: string) => void;\n}\n\ninterface UseGeolocationReturn {\n  location: { latitude: number; longitude: number } | null;\n  error: string | null;\n  loading: boolean;\n  getCurrentLocation: () => Promise<void>;\n  clearLocation: () => void;\n  isSupported: boolean;\n}\n\nexport const useGeolocation = (options: UseGeolocationOptions = {}): UseGeolocationReturn => {\n  const {\n    userLocation,\n    locationPermission,\n    setUserLocation,\n    setLocationPermission\n  } = useLocation();\n\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  // 檢查瀏覽器是否支援地理定位\n  const isSupported = 'geolocation' in navigator;\n\n  /**\n   * 取得目前位置\n   */\n  const getCurrentLocation = useCallback(async () => {\n    if (!isSupported) {\n      const errorMsg = '此瀏覽器不支援地理定位功能';\n      setError(errorMsg);\n      options.onError?.(errorMsg);\n      toast.error(errorMsg);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const position = await locationApi.getCurrentLocation();\n\n      setUserLocation(position);\n      setLocationPermission(true);\n      setError(null);\n\n      options.onSuccess?.(position);\n      toast.success('已取得您的位置');\n\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : '無法取得位置資訊';\n\n      setError(errorMsg);\n      setLocationPermission(false);\n      options.onError?.(errorMsg);\n\n      // 針對不同錯誤類型顯示不同訊息\n      if (errorMsg.includes('拒絕')) {\n        toast.error('請允許位置存取以搜尋附近醫院', {\n          duration: 5000\n        });\n      } else if (errorMsg.includes('超時')) {\n        toast.error('定位超時，請檢查GPS設定');\n      } else {\n        toast.error(errorMsg);\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [isSupported, options, setUserLocation, setLocationPermission]);\n\n  /**\n   * 清除位置資訊\n   */\n  const clearLocation = useCallback(() => {\n    setUserLocation(null);\n    setError(null);\n    setLocationPermission(false);\n  }, [setUserLocation, setLocationPermission]);\n\n  /**\n   * 監聽位置權限變化\n   */\n  useEffect(() => {\n    if (!isSupported) return;\n\n    // 檢查位置權限狀態\n    if ('permissions' in navigator) {\n      navigator.permissions.query({ name: 'geolocation' }).then((result) => {\n        setLocationPermission(result.state === 'granted');\n\n        // 監聽權限變化\n        result.addEventListener('change', () => {\n          const hasPermission = result.state === 'granted';\n          setLocationPermission(hasPermission);\n\n          if (result.state === 'denied') {\n            setUserLocation(null);\n            setError('位置存取被拒絕');\n          }\n        });\n      }).catch(() => {\n        // 某些瀏覽器不支援 permissions API\n        console.warn('Cannot check geolocation permission');\n      });\n    }\n  }, [isSupported, setLocationPermission, setUserLocation]);\n\n  return {\n    location: userLocation,\n    error,\n    loading,\n    getCurrentLocation,\n    clearLocation,\n    isSupported\n  };\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}